<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <script src="config.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--网站标题-->
    <script>
        // 设置页面标题
        document.title = CONFIG.title;
    </script>

    <script>
        // 设置网站图标
        const link = document.createElement('link');
        link.rel = 'icon';
        link.href = CONFIG.icon;
        link.type = 'image/png';
        document.head.appendChild(link);
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!--个性化字体--> 
    <script>
        const fontLink = document.createElement('link');
        fontLink.rel = 'stylesheet';
        fontLink.href = CONFIG.font;
        fontLink.type = 'text/css';
        document.head.appendChild(fontLink);
    </script>

    <!--busuanzi国内接口-->
    <script src="https://cn.vercount.one/js" async></script>

    <!-- Umami 统计脚本 -->
    <script>
        const umamiScript = document.createElement('script');
        umamiScript.defer = true;
        umamiScript.src = CONFIG.umami_domain + '/script.js';  // 注意：需要完整的脚本URL
        umamiScript.setAttribute('data-website-id', CONFIG.umami_id);
        umamiScript.async = true;  // 通常也加上async
        document.head.appendChild(umamiScript);
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const umamiScript = document.querySelector(`script[src="${CONFIG.umami_domain}/script.js"]`);
            if (umamiScript && CONFIG && CONFIG.umami_id) {
                umamiScript.setAttribute('data-website-id', CONFIG.umami_id);
                
            }
        });
    </script>

    <script>
        // 切换弹窗显示/隐藏
        function toggleModal() {
            const modal = document.getElementById('settingsModal');
            if (modal.style.display === 'flex') {
                modal.style.display = 'none';
            } else {
                modal.style.display = 'flex';
            }
        }

        // 点击遮罩层空白处也可关闭
        window.onclick = function(event) {
            const modal = document.getElementById('settingsModal');
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    </script>

    <style>
        :root {
            --accent-color: #64ffda;
            --glass-bg: rgba(20, 20, 20, 0.25);
            --border: 1px solid rgba(255, 255, 255, 0.1);
            --trans-fast: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            /* 新增：统一的容器最大宽度变量 */
            --container-max-width: 1200px;
            --compact-max-width: 550px; /* 增加紧凑模式宽度 */
        }

        /* 全局布局 */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            
        }

        /* 修改后的 body 样式 */
        body {
            font-family: 'LXGW WenKai Screen', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 20px;
            zoom: 0.9;
            transition: justify-content 0.5s ease;
            
            /* --- 找回背景图的关键：读取 config.js 中的背景配置 --- */
            background: url('https://api.onenight.me/api/bing/auto') no-repeat center center fixed; /* 示例图，如果是动态背景请确保这里正确 */
            background-size: cover;
            color: white; /* 确保文字是白的，不会变成纯黑主题感 */
        }

        /* 确保遮罩层正常工作，这样背景才不会太刺眼 */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5); /* 调整这里的 0.5 可以控制背景明暗 */
            z-index: -1; /* 确保在最底层 */
            pointer-events: none;
        }

        .dashboard {
            display: flex;
            gap: 24px;
            max-width: 1200px;
            width: 100%;
            height: 100%;
            flex-wrap: wrap;
            align-items: center;
            margin-top: 10px;
            margin-bottom: 30px;
            /* 为页脚留出空间 */
            position: relative;
            z-index: 1;
            transition: max-width 0.5s ease, transform 0.3s ease; /* 增加平滑过渡 */
        }

        .col-left, .col-right {
            flex: 1;
            min-width: 320px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            justify-content: flex-start;
            /* 移除 min-height: 700px; */
        }

        /* 通用卡片 */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border: var(--border);
            border-radius: 24px;
            padding: 30px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            width: 100%;
            display: flex;
            flex-direction: column;
            /* --- 以下是关键修改点 --- */
            flex-grow: 0;           /* 确保卡片不会被强制拉长 */
            flex-shrink: 1;         /* 防止卡片被压缩 */
            height: fit-content;    /* 高度根据内容自动撑开 */
        }

        /* 个人信息 */
        .profile {
            text-align: center;
            width: 100%;
            padding-bottom: 15px;
        }

        .avatar {
            width: 110px;
            height: 110px;
            border-radius: 50%;
            border: 3px solid var(--accent-color);
            margin-bottom: 20px;
            transition: var(--trans-fast);
        }

        .avatar:hover {
            transform: rotate(360deg);
        }

        .name {
            font-size: 1.8rem;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .bio {
            font-size: 0.95rem;
            color: #ccc;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        /* 社交账号 */
        .social-links {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 10px;
        }

        .social-item {
            width: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: var(--border);
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            font-size: 1.1rem;
            transition: var(--trans-fast);
        }

        .social-item:hover {
            background: rgba(100, 255, 218, 0.1);
            color: var(--accent-color);
            border-color: var(--accent-color);
            transform: translateY(-3px);
        }

        /* 监控条 */
        .stat-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ff88;
            box-shadow: 0 0 10px #00ff88;
        }

        .progress-item {
            margin-bottom: 15px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            margin-bottom: 6px;
            color: #ddd;
        }

        .progress-bg {
            background: rgba(255, 255, 255, 0.1);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--accent-color), #4facfe);
            transition: width 1s ease;
            border-radius: 4px;
        }

        /* 快捷入口 */
        .link-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 固定5列，防止换行 */
            gap: 12px;
        }

        .grid-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 5px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            text-decoration: none;
            color: white;
            border: 1px solid transparent;
            transition: var(--trans-fast);
        }

        .grid-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent-color);
            transform: translateY(-5px);
        }

        .grid-icon {
            width: 32px;
            height: 32px;
            margin-bottom: 8px;
            border-radius: 6px;
        }

        .grid-item span {
            font-size: 0.75rem;
        }

        /* 一言 */
        .hitokoto-text {
            font-size: 0.95rem;
            font-style: italic;
            line-height: 1.6;
            color: #eee;
            min-height: 4em;
        }

        .small-widgets {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .widget-box {
            flex: 1;
            text-align: center;
        }

        .widget-val {
            font-size: 1.1rem;
            font-weight: bold;
            display: block;
        }

        .widget-label {
            font-size: 0.65rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* 页脚样式 */
        .footer {
            width: 100%;
            max-width: 1200px;
            text-align: center;
            padding: 25px;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: auto; /* 这是一个技巧：在 flex 布局中将页脚推到底部或保持间距 */
            margin-bottom: 20px;
        }

        .badge-list {
            display: flex;
            justify-content: center;
            gap: 6px;
            flex-wrap: wrap;
            margin-top: 12px;
            opacity: 0.8;
        }

        .badge-list img {
            height: 20px;
        }

        /* GitHub贡献图样式 */
        .github-chart-img {
            width: 100%;
            max-width: 100%;
            border-radius: 12px;
            margin-top: 15px;
            display: block;
        }

        .github-chart-container {
            width: 100%;
            max-width: 100%;
            border-radius: 12px;
            margin-top: 15px;
            overflow: hidden;
        }

        .github-chart-caption {
            font-size: 0.8rem;
            color: #aaa;
            text-align: center;
            margin-top: 10px;
        }

        /* 最新说说卡片样式 */
        .echo-container {
            margin-top: 15px;
            min-height: 120px;
        }

        .echo-loading {
            text-align: center;
            padding: 30px 0;
            color: #aaa;
            font-size: 0.9rem;
        }

        .echo-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            border: 1px solid transparent;
            transition: var(--trans-fast);
        }

        .echo-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 107, 107, 0.3);
        }

        .echo-content {
            font-size: 0.9rem;
            line-height: 1.6;
            color: #eee;
            margin-bottom: 10px;
            word-break: break-word;
        }

        .echo-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
            color: #888;
        }

        .echo-time {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .echo-likes {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #64ffda;
        }

        .echo-footer {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .echo-link {
            color: #64ffda;
            text-decoration: none;
            font-size: 0.8rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: var(--trans-fast);
        }

        .echo-link:hover {
            color: #4aff7a;
            text-decoration: underline;
        }

        .echo-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 8px;
        }

        .echo-tag {
            background: rgba(100, 255, 218, 0.1);
            color: #64ffda;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            border: 1px solid rgba(100, 255, 218, 0.2);
        }

        @media (max-width: 768px) {
            .dashboard {
                flex-direction: column;
            }

            body {
                padding: 20px 10px;
            }
            
            .echo-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
        }

        /* 弹窗遮罩层 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            display: none; /* 初始隐藏 */
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        /* 弹窗内容体 */
        .modal-content {
            max-width: 400px;
            width: 90%;
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .close-btn {
            margin-left: auto;
            cursor: pointer;
            font-size: 1.5rem;
            color: #888;
            transition: var(--trans-fast);
        }

        .close-btn:hover {
            color: var(--accent-color);
        }

        /* 弹窗内条目样式 */
        .setting-item {
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 12px;
        }
        
        .dashboard, .footer {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dashboard.compact-mode {
            max-width: 550px; /* 增加宽度 */
            margin-top: 0;
            margin-bottom: 20px;
        }

        .footer.compact-mode {
            max-width: 550px; /* 增加宽度 */
            margin-top: 20px; /* 较小的间距 */
        }
        
        /* 紧凑模式下的个人信息卡片优化 */
        .dashboard.compact-mode .glass-card {
            padding: 20px; /* 减少内边距 */
        }
        
        .dashboard.compact-mode .profile {
            padding-bottom: 10px; /* 减少底部内边距 */
        }
        
        .dashboard.compact-mode .avatar {
            width: 90px; /* 缩小头像 */
            height: 90px;
            margin-bottom: 15px;
        }
        
        .dashboard.compact-mode .name {
            font-size: 1.5rem; /* 缩小名字字体 */
            margin-bottom: 8px;
        }
        
        .dashboard.compact-mode .bio {
            font-size: 0.85rem; /* 缩小简介字体 */
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .dashboard.compact-mode .social-item {
            width: 34px; /* 缩小社交图标 */
            height: 34px;
            font-size: 1rem;
        }
        
       
        
    </style>
</head>

<div id="settingsModal" class="modal-overlay">
    <div class="glass-card modal-content">
        <div class="stat-header">
            <i class="fas fa-th-large"></i>
            <span>看板布局管理 / Layout</span>
            <span class="close-btn" onclick="toggleModal()">&times;</span>
        </div>
        <div style="padding: 10px 0; font-size: 0.9rem;">
            <div class="setting-item"><span>一言统计</span><input type="checkbox" id="check-hitokoto" checked onchange="toggleSection('hitokoto-card', this.checked)"></div>
            <div class="setting-item"><span>最新说说</span><input type="checkbox" id="check-echo" checked onchange="toggleSection('echo-card', this.checked)"></div>
            <div class="setting-item"><span>系统监控</span><input type="checkbox" id="check-monitor" checked onchange="toggleSection('monitor-card', this.checked)"></div>
            <div class="setting-item"><span>快捷入口</span><input type="checkbox" id="check-links" checked onchange="toggleSection('links-card', this.checked)"></div>
            <div class="setting-item"><span>Github图</span><input type="checkbox" id="check-github" checked onchange="toggleSection('github-card', this.checked)"></div>

            <div style="display: flex; justify-content: center; width: 100%; margin-top: 20px;">
                <button style="border: 1px solid var(--accent-color); padding: 8px 30px; border-radius: 12px; background: rgba(100, 255, 218, 0.1); color: var(--accent-color); cursor: pointer; text-decoration: none; font-size: 0.85rem; transition: var(--trans-fast);" onclick="toggleModal()">
                    保存配置
                </button>
            </div>
        </div>
    </div>
</div>

<body>

    <div class="dashboard">
        <div class="col-left">
            <div class="glass-card">
                <div class="profile">
                    <img src="https://pic1.imgdb.cn/item/68fe309a3203f7be00a0c198.png" class="avatar" alt="Avatar">
                    <h2 class="name">LucasAndrew</h2>
                    <p class="bio"><br><script>document.write(CONFIG.aphorism1);</script></p>
                    <div class="social-links">
                        <a href="https://github.com/lucasandrew0120" target="_blank" class="social-item"
                            title="GitHub"><i class="fab fa-github"></i></a>
                        <a href="mailto:LucasAndrew0120@outlook.com" class="social-item" title="Email"><i
                                class="fas fa-envelope"></i></a>
                        <a href="javascript:void(0);" class="social-item" title="设置" onclick="toggleModal()"><i 
                                class="fas fa-cog"></i></a>
                    </div>
                </div>
            </div>

            <div class="glass-card" id="hitokoto-card">
                <div id="hitokoto_text" class="hitokoto-text">正在摘取星辰...</div>
                <div class="small-widgets">
                    <div class="widget-box">
                        <span id="busuanzi_value_site_pv" class="widget-val">1</span>
                        <span class="widget-label">访客 PV</span>
                    </div>
                    <div class="widget-box">
                        <span id="temp-val" class="widget-val">--</span>
                        <span id="loc-val" class="widget-label">城市</span>
                    </div>
                </div>
            </div>

            <!-- 最新说说卡片 -->
            <div class="glass-card" id="echo-card">
                <div class="stat-header">
                    <div class="status-dot" style="background: #64ffda;"></div>
                    <span>最新碎碎念 / Latest Thinking</span>
                </div>
                <div id="echo-container" class="echo-container">
                    <div class="echo-loading">正在加载最新说说...</div>
                </div>
                <div class="echo-footer">
                    <a href="https://ech0.lris625.top/" target="_blank" class="echo-link">
                        查看更多碎碎念 <i class="fas fa-external-link-alt"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="col-right">
            <div class="glass-card" id="monitor-card">
                <div class="stat-header">
                    <div class="status-dot"></div>
                    <span>系统监控 (Real-time Status)</span>
                </div>
                <div class="progress-item">
                    <div class="progress-label"><span>CPU 负载</span> <span id="cpu-val">0%</span></div>
                    <div class="progress-bg">
                        <div class="progress-bar" id="cpu-bar"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-label"><span>内存使用</span> <span id="ram-val">0%</span></div>
                    <div class="progress-bg">
                        <div class="progress-bar" id="ram-bar"
                            style="background: linear-gradient(90deg, #fce38a, #f38181);"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-label"><span>磁盘空间</span> <span id="disk-val">0%</span></div>
                    <div class="progress-bg">
                        <div class="progress-bar" id="disk-bar"
                            style="background: linear-gradient(90deg, #a8edea, #fed6e3);"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-label"><span>续费倒计时</span> <span id="days-val">-- 天</span></div>
                    <div class="progress-bg">
                        <div class="progress-bar" id="days-bar"></div>
                    </div>
                </div>
                <div
                    style="display: flex; justify-content: space-between; font-size: 0.7rem; color: #888; margin-top: 5px;">
                    <span><i class="fas fa-download"></i> <span id="net-in">0</span> KB/s</span>
                    <span id="uptime-val">UPTIME: LOADING</span>
                    <span><i class="fas fa-upload"></i> <span id="net-out">0</span> KB/s</span>
                </div>
            </div>

            <div class="glass-card" id="links-card">
                <div class="stat-header">快捷入口 / Shortcuts</div>
                <div class="link-grid">
                    <a href="https://blog.lris625.top/" target="_blank" class="grid-item">
                        <img src="https://pic1.imgdb.cn/item/68fe309a3203f7be00a0c198.png" class="grid-icon">
                        <span>个人博客</span>
                    </a>
                    <a href="https://openlist.lris625.top/" target="_blank" class="grid-item">
                        <img src="https://res.oplist.org/logo/logo.svg" class="grid-icon">
                        <span>OpenList</span>
                    </a>
                    <a href="https://speed.lris625.top/" target="_blank" class="grid-item">
                        <img src="https://cdn.jsdelivr.net/gh/homarr-labs/dashboard-icons/svg/librespeed.svg"
                            class="grid-icon">
                        <span>LibreSpeed</span>
                    </a>
                    <a href="https://ech0.lris625.top/" target="_blank" class="grid-item">
                        <img src="https://pic1.imgdb.cn/item/695a8afca6ed793b783b6427.webp" class="grid-icon">
                        <span>碎碎念</span>
                    </a>
                    <a href="https://read.lris625.top/" target="_blank" class="grid-item">
                        <img src="https://favicon.im/read.lris625.top" class="grid-icon">
                        <span>阅读</span>
                    </a>
                </div>
            </div>

            <div class="glass-card" id="github-card">
                <div class="stat-header">
                    <div class="status-dot" style="background: #64ffda;"></div>
                    <span>GitHub 贡献图 / Contributions</span>
                </div>
                <div class="github-chart-container" id="github-chart-container">
                    <!-- SVG将在这里动态加载 -->
                </div>
                <div class="github-chart-caption" id="github-chart-caption">
                    数据加载中... · LucasAndrew0120's Github chart
                </div>
            </div>
        </div>
    </div>

    <footer class="footer glass-card">
        <div style="margin-bottom: 10px;">
            © 2026 <script>document.write(CONFIG.name);</script> <span id="runtime-val">载入中...</span>
        </div>

        <div class="badge-list">
            <img src="https://img.shields.io/badge/Server-1Panel-orange?style=flat-square" alt="1Panel">
            <img src="https://img.shields.io/badge/Web-OpenResty-009900?style=flat-square&logo=nginx" alt="OpenResty">

            <img src="https://img.shields.io/badge/Crafted%20with-Gemini%20AI-4285f4?style=flat-square&logo=google-gemini&logoColor=white"
                alt="Gemini AI">

            <img src="https://img.shields.io/badge/Stats-Vercount-0078d7?style=flat-square" alt="Vercount">
        </div>

        <div style="margin-top: 15px; font-size: 0.7rem; opacity: 0.5;">
            <script>document.write(CONFIG.aphorism2)</script>
        </div>
    </footer>

    <script>
        // 1. 系统状态更新 (10分钟一次)
        function updateStatus() {
            fetch('status.php')
                .then(res => res.json())
                .then(data => {
                    document.getElementById('cpu-val').innerText = data.cpu + '%';
                    document.getElementById('cpu-bar').style.width = data.cpu + '%';
                    document.getElementById('ram-val').innerText = data.mem + '%';
                    document.getElementById('ram-bar').style.width = data.mem + '%';
                    document.getElementById('disk-val').innerText = data.disk + '%';
                    document.getElementById('disk-bar').style.width = data.disk + '%';
                    document.getElementById('net-in').innerText = data.net_in;
                    document.getElementById('net-out').innerText = data.net_out;
                    document.getElementById('uptime-val').innerText = 'UP: ' + data.uptime.toUpperCase();
                    document.getElementById('days-val').innerText = data.days_left + ' 天';
                    document.getElementById('days-bar').style.width = Math.min((data.days_left / 30) * 100, 100) + '%';
                }).catch(e => console.log("服务器数据同步中..."));
        }

        // 2. 运行时间计算 (精确到天)
        function calculateRuntime() {
            const startDate = new Date('2025-11-27'); // 改为你网站实际开始的日期
            const today = new Date();
            const timeDiff = today - startDate;
            const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            document.getElementById('runtime-val').innerText = `已在西洲停留 ${days} 个昼夜`;
        }

        // 3. 天气更新 (高德 IP 定位 + 和风天气)
        async function updateWeather() {
            const qweatherKey = CONFIG.qweatherKey;
            const amapKey = CONFIG.amapKey; // 从 config.js 中获取高德API密钥

            try {
                const amapRes = await fetch(`https://restapi.amap.com/v3/ip?key=${amapKey}`);
                const amapData = await amapRes.json();
                let cityName = (amapData.status === '1' && typeof amapData.city === 'string') ? amapData.city : '北京';

                const geoRes = await fetch(`https://geoapi.qweather.com/v2/city/lookup?location=${cityName}&key=${qweatherKey}`);
                const geoData = await geoRes.json();

                if (geoData.code === '200' && geoData.location) {
                    const locationId = geoData.location[0].id;
                    const displayCity = geoData.location[0].name;
                    const weatherRes = await fetch(`https://devapi.qweather.com/v7/weather/now?location=${locationId}&key=${qweatherKey}`);
                    const weatherData = await weatherRes.json();

                    if (weatherData.code === '200') {
                        document.getElementById('temp-val').innerText = weatherData.now.temp + '°C';
                        document.getElementById('loc-val').innerText = displayCity + ' · ' + weatherData.now.text;
                    }
                }
            } catch (e) {
                document.getElementById('temp-val').innerText = "N/A";
                document.getElementById('loc-val').innerText = "定位失败";
            }
        }

        // 4. 一言更新
        function updateHitokoto() {
            fetch('https://v1.hitokoto.cn')
                .then(res => res.json())
                .then(data => {
                    document.getElementById('hitokoto_text').innerText = data.hitokoto;
                });
        }

        // 5. 更新GitHub贡献图说明
        function updateGitHubChartInfo() {
            fetch('github_contributions.php')
                .then(res => res.json())
                .then(data => {
                    if (data && data.last_updated) {
                        const lastUpdated = new Date(data.last_updated);
                        const now = new Date();
                        const diffHours = Math.floor((now - lastUpdated) / (1000 * 60 * 60));
                        
                        let updateText = '数据已缓存';
                        if (diffHours < 1) {
                            updateText = '数据刚刚更新';
                        } else if (diffHours === 1) {
                            updateText = '数据1小时前更新';
                        } else if (diffHours < 24) {
                            updateText = `数据${diffHours}小时前更新`;
                        } else {
                            const diffDays = Math.floor(diffHours / 24);
                            updateText = `数据${diffDays}天前更新`;
                        }
                        
                        const totalContributions = data.contributions?.total || 0;
                        const caption = document.getElementById('github-chart-caption');
                        if (caption) {
                            caption.innerHTML = `${updateText} · 最近30天共${totalContributions}次提交 · LucasAndrew0120's Github chart`;
                        }
                    }
                })
                .catch(e => {
                    console.log("GitHub贡献数据获取失败");
                    const caption = document.getElementById('github-chart-caption');
                    if (caption) {
                        caption.innerHTML = '数据每两小时更新一次 · LucasAndrew0120\'s Github chart';
                    }
                });
        }

        // 6. 动态加载GitHub贡献图SVG
        function loadGitHubChart() {
            const container = document.getElementById('github-chart-container');
            const caption = document.getElementById('github-chart-caption');
            
            if (!container) return;
            
            // 添加时间戳避免缓存
            fetch('github_contributions.php?format=svg&t=' + new Date().getTime())
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(svgText => {
                    // 直接插入SVG内容
                    container.innerHTML = svgText;
                    
                    // 更新说明信息
                    updateGitHubChartInfo();
                    
                    // 确保SVG的宽度适应容器
                    const svgElement = container.querySelector('svg');
                    if (svgElement) {
                        svgElement.style.width = '100%';
                        svgElement.style.height = '100%';
                        svgElement.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.log("贡献图加载失败，使用备用图片", error);
                    // 备用方案：使用图片
                    container.innerHTML = `<img src="https://ghchart.rshah.org/${github_username}" alt="GitHub Contributions" style="width:100%; border-radius:12px;">`;
                    if (caption) {
                        caption.innerHTML = `数据加载失败，使用备用图表 · ${github_username}'s Github chart`;
                    }
                });
        }

        // 7. 加载最新Ech0说说
        function loadLatestEcho() {
            const container = document.getElementById('echo-container');
            if (!container) return;
            
            // 显示加载状态
            container.innerHTML = '<div class="echo-loading">正在加载最新说说...</div>';
            
            // Ech0 API地址 - 使用用户提供的地址
            const echoApiUrl = CONFIG.echoApiUrl;
            
            // 请求参数：获取第一页，每页3条
            const params = new URLSearchParams({
                page: '1',
                pageSize: '1'
            });
            
            // 添加调试信息
            console.log('正在请求Ech0 API:', `${echoApiUrl}?${params}`);
            
            fetch(`${echoApiUrl}?${params}`, {
                mode: 'cors', // 明确指定CORS模式
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            })
                .then(response => {
                    console.log('API响应状态:', response.status, response.statusText);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status} - ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('API响应数据:', data);
                    
                    // 检查API响应格式 - 根据实际响应调整
                    let echoes = null;
                    
                    // 格式1: {code: 1, data: {items: [...]}}
                    if (data.code === 1 && data.data && data.data.items && Array.isArray(data.data.items)) {
                        echoes = data.data.items;
                    }
                    // 格式2: {code: 1, data: [...]}
                    else if (data.code === 1 && data.data && Array.isArray(data.data)) {
                        echoes = data.data;
                    }
                    // 格式3: {data: {data: [...]}}
                    else if (data.data && data.data.data && Array.isArray(data.data.data)) {
                        echoes = data.data.data;
                    }
                    // 格式4: 直接返回数组
                    else if (Array.isArray(data)) {
                        echoes = data;
                    }
                    // 格式5: {data: [...]}
                    else if (data.data && Array.isArray(data.data)) {
                        echoes = data.data;
                    }
                    // 格式6: {echoes: [...]}
                    else if (data.echoes && Array.isArray(data.echoes)) {
                        echoes = data.echoes;
                    }
                    // 格式7: {items: [...]}
                    else if (data.items && Array.isArray(data.items)) {
                        echoes = data.items;
                    }
                    
                    if (echoes && echoes.length > 0) {
                        renderEchoes(echoes, container);
                    } else {
                        console.log('数据格式详情:', {
                            code: data.code,
                            hasData: !!data.data,
                            dataType: typeof data.data,
                            dataKeys: data.data ? Object.keys(data.data) : '无data',
                            isArray: Array.isArray(data.data),
                            isItemsArray: data.data && data.data.items && Array.isArray(data.data.items)
                        });
                        throw new Error('未找到说说数据或数据格式不正确');
                    }
                })
                .catch(error => {
                    console.error("Ech0说说加载失败:", error);
                    container.innerHTML = `
                        <div class="echo-loading">
                            <div>说说加载失败</div>
                            <div style="font-size: 0.8rem; margin-top: 5px; color: #888;">
                                错误: ${error.message}
                            </div>
                            <div style="font-size: 0.7rem; margin-top: 10px; color: #666;">
                                请打开浏览器控制台查看详细错误信息
                            </div>
                        </div>
                    `;
                });
        }

        // 渲染说说列表
        function renderEchoes(echoes, container) {
            if (!echoes || echoes.length === 0) {
                container.innerHTML = `
                    <div class="echo-loading">
                        暂无说说内容
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            echoes.forEach(echo => {
                // 格式化时间
                const createdAt = echo.created_at ? formatTime(echo.created_at) : '未知时间';
                
                // 处理标签
                let tagsHtml = '';
                if (echo.tags && Array.isArray(echo.tags) && echo.tags.length > 0) {
                    tagsHtml = '<div class="echo-tags">';
                    echo.tags.forEach(tag => {
                        if (tag.name) {
                            tagsHtml += `<span class="echo-tag">${tag.name}</span>`;
                        }
                    });
                    tagsHtml += '</div>';
                }
                
                // 处理内容 - 限制长度并处理换行
                let content = echo.content || '';
                if (content.length > 120) {
                    content = content.substring(0, 120) + '...';
                }
                content = content.replace(/\n/g, '<br>');
                
                html += `
                    <div class="echo-item">
                        <div class="echo-content">${content}</div>
                        ${tagsHtml}
                        <div class="echo-meta">
                            <div class="echo-time">
                                <i class="far fa-clock"></i>
                                <span>${createdAt}</span>
                            </div>
                            <div class="echo-likes">
                                <i class="fas fa-heart"></i>
                                <span>${echo.fav_count || 0}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // 格式化时间
        function formatTime(timeString) {
            try {
                const date = new Date(timeString);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / (1000 * 60));
                const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                
                if (diffMins < 1) {
                    return '刚刚';
                } else if (diffMins < 60) {
                    return `${diffMins}分钟前`;
                } else if (diffHours < 24) {
                    return `${diffHours}小时前`;
                } else if (diffDays < 7) {
                    return `${diffDays}天前`;
                } else {
                    // 超过一周显示具体日期
                    return date.toLocaleDateString('zh-CN', {
                        month: 'short',
                        day: 'numeric'
                    });
                }
            } catch (e) {
                return '未知时间';
            }
        }

        // 1. 核心切换函数 - 修复保存问题
        function toggleSection(sectionId, isVisible) {
            const element = document.getElementById(sectionId);
            if (element) {
                element.style.display = isVisible ? 'flex' : 'none';
                // 保存状态到本地 - 使用字符串存储
                localStorage.setItem('config_' + sectionId, isVisible.toString());
                initLayout(); // 每次切换状态后重新计算布局
            }
        }

        // 增强版布局初始化逻辑 - 修复逻辑错误
       function initLayout() {
            const sections = ['hitokoto-card', 'echo-card', 'monitor-card', 'links-card', 'github-card'];
            let visibleCount = 0;
            
            sections.forEach(id => {
                const saved = localStorage.getItem('config_' + id);
                const el = document.getElementById(id);
                const isVisible = saved === null ? true : (saved === 'true');
                
                if (el) {
                    el.style.display = isVisible ? 'flex' : 'none';
                    if (isVisible) visibleCount++;
                }
                
                const checkbox = document.getElementById('check-' + id.split('-')[0]);
                if (checkbox) checkbox.checked = isVisible;
            });

            const body = document.body;
            const dashboard = document.querySelector('.dashboard');
            const colRight = document.querySelector('.col-right');

            if (visibleCount === 0) {
                // --- 紧凑居中模式 ---
                body.style.justifyContent = 'center'; // body 负责垂直居中
                dashboard.classList.add('compact-mode');
                if(colRight) colRight.style.display = 'none'; // 隐藏空的右侧列，防止偏移
            } else {
                // --- 正常列表模式 ---
                body.style.justifyContent = 'flex-start';
                dashboard.classList.remove('compact-mode');
                if(colRight) colRight.style.display = 'flex';
            }
        }

        // 只有系统状态是 10 分钟刷一次，减轻服务器压力
        setInterval(updateStatus, 600000); 
        
        // 每2小时更新一次贡献图数据
        setInterval(loadGitHubChart, 7200000);
        
        // 每30分钟更新一次说说数据
        setInterval(loadLatestEcho, 1800000);

        // 在页面加载完成后执行初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 先初始化布局
            initLayout();
            
            // 然后加载其他数据
            updateStatus();
            calculateRuntime();
            updateWeather();
            updateHitokoto();
            loadGitHubChart();
            loadLatestEcho();
            document.body.style.backgroundImage = `url(${CONFIG.background})`;
        });
    </script>

</body>

</html>
